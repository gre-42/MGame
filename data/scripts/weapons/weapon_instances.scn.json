[
  {"include": "weapon_closeup.scn.json"},
  {"include": "muzzle_flash_closeup.scn.json"},
  {
    "declare_macro": "delete_weapon",
    "content": [
      { "call": "clear_node", "arguments": { "node": "main_gun_end_node$suffix" } },
      { "call": "clear_node", "arguments": { "node": "main_gun_node_visual$suffix" } }
    ]
  },
  {
    "declare_macro": "_generate_muzzle_flash",
    "content": {
      "call": "emit_child_particle",
      "arguments": {
        "node": "muzzle_flash_node_$suffix",
        "resource": "%resource",
        "location": {
          "position": [0, 0, 0],
          "rotation": [0, 0, 0],
          "scale": 1
        }
      }
    }
  },
  {
    "declare_macro": "add_weapon_m4a1",
    "content": [
      { "playback": "delete_weapon" },
      {
        "comment": {
          "call": "child_renderable_instance",
          "arguments": {
            "name": "main_gun_node_visual-box",
            "node": "main_gun_node_visual$suffix",
            "resource": "box"
          }
        }
      },
      {
        "call": "child_renderable_instance",
        "arguments": {
          "name": "main_gun_node_visual-inst",
          "node": "main_gun_node_visual$suffix",
          "resource": "M4A1"
        }
      },
      {
        "playback": "_generate_weapon_hider",
        "arguments": {
          "resource": "M4A1",
          "muzzle_flash_position": [0, 0.062, -0.66]
        }
      },
      {
        "call": "gun",
        "arguments": {
          "node": "main_gun_end_node$suffix",
          "parent_rigid_body_node": "human_node$suffix",
          "ypln_node": "human_node$suffix",
          "punch_angle_node": "main_gun_punch_angle_node$suffix",
          "punch_angle_idle_std": 0.1,
          "punch_angle_shoot_std": 0.3,
          "generate_muzzle_flash": [
            {
              "playback": "_generate_muzzle_flash",
              "arguments": {
                "resource": "muzzle_flash_0_3d_orange_brown"
              }
            },
            {
              "playback": "_generate_muzzle_flash_closeup",
              "arguments": {
                "resource": "muzzle_flash_0_3d_orange_brown"
              }
            }
          ],
          "cool_down": "%cool_down",
          "ammo_type": "%ammo_type",
          "bullet_type": "%bullet_type",
          "shot_audio": "cg1.shot"
        }
      },
      {
        "call": "ypln_update_bullet_properties",
        "arguments": {
          "gun_node": "main_gun_end_node$suffix",
          "ypln_node": "human_node$suffix",
          "dpitch_head": 0,
          "bullet_type": "%bullet_type"
        }
      },
      {
        "call": "child_node_instance",
        "arguments": {
          "type": "dynamic",
          "parent": "main_gun_node_visual$suffix",
          "name": "muzzle_flash_node_$suffix",
          "position": [0, 0.1, -0.65],
          "rotation": [0, 0, 0],
          "scale": 1
        }
      },
      {
        "call": "set_particle_renderer",
        "arguments": {
          "node": "muzzle_flash_node_$suffix",
          "renderable": "particle_renderer"
        }
      }
    ]
  },
  {
    "declare_macro": "add_weapon_beretta92",
    "content": [
      { "playback": "delete_weapon" },
      {
        "comment": {
          "call": "child_renderable_instance",
          "arguments": {
            "name": "main_gun_node_visual-box",
            "node": "main_gun_node_visual$suffix",
            "resource": "box"
          }
        }
      },
      {
        "call": "child_renderable_instance",
        "arguments": {
          "name": "main_gun_node_visual-inst",
          "node": "main_gun_node_visual$suffix",
          "resource": "Beretta92"
        }
      },
      {
        "playback": "_generate_weapon_hider",
        "arguments": {
          "resource": "Beretta92",
          "muzzle_flash_position": [0, 0.086, -0.265]
        }
      },
      {
        "call": "gun",
        "arguments": {
          "node": "main_gun_end_node$suffix",
          "parent_rigid_body_node": "human_node$suffix",
          "ypln_node": "human_node$suffix",
          "punch_angle_node": "main_gun_punch_angle_node$suffix",
          "punch_angle_idle_std": 0.1,
          "punch_angle_shoot_std": 0.3,
          "generate_muzzle_flash": [
            {
              "playback": "_generate_muzzle_flash",
              "arguments": {
                "resource": "muzzle_flash_0_3d_orange_brown"
              }
            },
            {
              "playback": "_generate_muzzle_flash_closeup",
              "arguments": {
                "resource": "muzzle_flash_0_3d_orange_brown"
              }
            }
          ],
          "cool_down": "%cool_down",
          "ammo_type": "%ammo_type",
          "bullet_type": "%bullet_type",
          "shot_audio": "pistol.shot"
        }
      },
      {
        "call": "ypln_update_bullet_properties",
        "arguments": {
          "gun_node": "main_gun_end_node$suffix",
          "ypln_node": "human_node$suffix",
          "dpitch_head": 0,
          "bullet_type": "%bullet_type"
        }
      },
      {
        "call": "child_node_instance",
        "arguments": {
          "type": "dynamic",
          "parent": "main_gun_node_visual$suffix",
          "name": "muzzle_flash_node_$suffix",
          "position": [0, 0.1, -0.25],
          "rotation": [0, 0, 0],
          "scale": 1
        }
      },
      {
        "call": "set_particle_renderer",
        "arguments": {
          "node": "muzzle_flash_node_$suffix",
          "renderable": "particle_renderer"
        }
      }
    ]
  },
  {
    "declare_macro": "add_weapon_frag_grenade",
    "content": [
      { "playback": "delete_weapon" },
      {
        "comment": {
          "call": "child_renderable_instance",
          "arguments": {
            "name": "main_gun_node_visual-box",
            "node": "main_gun_node_visual$suffix",
            "resource": "box"
          }
        }
      },
      {
        "call": "child_renderable_instance",
        "arguments": {
          "name": "main_gun_node_visual-inst",
          "node": "main_gun_node_visual$suffix",
          "resource": "frag_grenade"
        }
      },
      {
        "playback": "_generate_weapon_hider",
        "arguments": {
          "resource": "frag_grenade",
          "muzzle_flash_position": null
        }
      },
      {
        "call": "gun",
        "arguments": {
          "node": "main_gun_end_node$suffix",
          "parent_rigid_body_node": "human_node$suffix",
          "ypln_node": "human_node$suffix",
          "punch_angle_node": "main_gun_punch_angle_node$suffix",
          "punch_angle_idle_std": 0.1,
          "punch_angle_shoot_std": 0.3,
          "cool_down": "%cool_down",
          "ammo_type": "%ammo_type",
          "bullet_type": "%bullet_type"
        }
      },
      {
        "call": "ypln_update_bullet_properties",
        "arguments": {
          "gun_node": "main_gun_end_node$suffix",
          "ypln_node": "human_node$suffix",
          "dpitch_head": -15,
          "bullet_type": "%bullet_type"
        }
      }
    ]
  },
  {
    "declare_macro": "add_weapon_m72_law",
    "content": [
      { "playback": "delete_weapon" },
      {
        "comment": {
          "call": "child_renderable_instance",
          "arguments": {
            "name": "main_gun_node_visual-box",
            "node": "main_gun_node_visual$suffix",
            "resource": "box"
          }
        }
      },
      {
        "call": "child_renderable_instance",
        "arguments": {
          "name": "main_gun_node_visual-inst",
          "node": "main_gun_node_visual$suffix",
          "resource": "m72_law"
        }
      },
      {
        "playback": "_generate_weapon_hider",
        "arguments": {
          "resource": "m72_law",
          "muzzle_flash_position": null
        }
      },
      {
        "call": "gun",
        "arguments": {
          "node": "main_gun_end_node$suffix",
          "parent_rigid_body_node": "human_node$suffix",
          "ypln_node": "human_node$suffix",
          "punch_angle_node": "main_gun_punch_angle_node$suffix",
          "punch_angle_idle_std": 0.1,
          "punch_angle_shoot_std": 0.3,
          "cool_down": "%cool_down",
          "ammo_type": "%ammo_type",
          "bullet_type": "%bullet_type"
        }
      },
      {
        "call": "ypln_update_bullet_properties",
        "arguments": {
          "gun_node": "main_gun_end_node$suffix",
          "ypln_node": "human_node$suffix",
          "dpitch_head": 0,
          "bullet_type": "%bullet_type"
        }
      }
    ]
  },
  {
    "declare_macro": "create_none_weapon",
    "content": [
      {
        "call": "gun",
        "arguments": {
          "node": "main_gun_end_node$suffix",
          "punch_angle_node": "main_gun_punch_angle_node$suffix",
          "ypln_node": "human_node$suffix",
          "cool_down": "inf",
          "punch_angle_idle_std": 0,
          "punch_angle_shoot_std": 0,
          "parent_rigid_body_node": "%parent_rigid_body_node",
          "ammo_type": "%ammo_type",
          "bullet_type": "%bullet_type"
        }
      },
      {
        "call": "ypln_update_bullet_properties",
        "arguments": {
          "gun_node": "main_gun_end_node$suffix",
          "ypln_node": "%parent_rigid_body_node",
          "dpitch_head": 0,
          "bullet_type": "%bullet_type"
        }
      }
    ]
  }
]
